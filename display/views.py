from typing import Any
from django.db import models
from django.db.models.query import QuerySet
from django.shortcuts import render, redirect
from django.contrib import messages
from django.urls import reverse
from .models import Club
from django.views import generic, View
import csv


class IndexView(generic.ListView):
    
    clubs_to_delete = Club.objects.all()
    clubs_to_delete.delete()
    clubs_list = [['Name of Club', 'Your First Name', 'Your Last Name', 'Who is your club advisor? **You MUST have a club advisor in order to be a club at Cannon**', 'Please provide an overview of your club. Please include your goals and objectives.  '], ['ABC (Athletes Bonding Club) ', 'Caden', 'Elnaggar ', 'Mr. Scurlock', 'The other leaders in this club are Tyler Martin and Cole Haigney. The goals and objectives of this club are to help other athletes in Cannon learn about the different ways to connect with their teammates, whether it is on the field/court, or off of it as friends. Chemistry is a piece of a team that can be very strong when going through a long, rigorous season. It allows the team to stay together, connected, and ultimately continue to strive to achieve the same goals. The club will hold either meetings, or lunches, to talk about different values and morals that athletes can hold themselves and others accountable for in order to build better relationships as friends, and as teammates. As each meeting is held, Cole, Tyler, and I will attempt to bring in different speakers from different levels of varying sports in order to give different perspectives on the subjects we talk about.  '], ['Battle of the Books ', 'Olivia', 'Equan', 'Ms. Earnshaw', 'Battle of the Books is a comprehension competition between other North Carolina high schools. Schools compete on a district, regional and state level. We plan to do a service project before the end of the year.'], ['Business Club', 'Wil', 'McDermott', 'Dean Williams', 'This club will meet every week and invite special guest (parents) to talk about their specialty in the business world. We would invite investors, doctors, business owners, entrepreneurs, and more. We would have one every other week, and the next discuss what they talked about. This club would strive to inform others about all fields of business, and we would attempt to have one final thing at the end of the year. This would be a shark tank type of event. We would learn & build up for this.'], ['Campus Cursive ', 'Molly', 'Reiss', 'Mrs. Huffman', 'To write letters to those who need an uplifting message. Our goals are to spread positivity and kindness.'], ['Creative Design and Engineering Club', 'Wyatt', 'Erdmann', 'Mr. Ruddy', 'The CDE club is a club that incorporates aspects of CDE 1 and 2 that mostly orients around woodworking, designing, coding, and other engineering skills.. Throughout the year you will complete different projects that teach different things about creating and engineering. During club meetings at the mill you will have time to work on these small projects with a friend or by yourself and at the end of each project you have an opportunity to share your projects with all of the other members of the club. With the help of the CDE teacher Mr. Ruddy you will have great resources to help you understand how to make these simple and unique creations. It is a great way to be exposed and learn about designing and engineering without taking the CDE art class. The goal of this club is for people to have the opportunity to participate in projects similar to the ones being done in the CDE classes, but it allows people who may not be able to take CDE, have already taken it or just want to be engaged in creating fun things.'], ['Chess Club', 'Chase', 'Herring', 'Mr. Hurtado', 'The club will consist of just playing chess, with the eventual goal to play tournaments and other activities in the future.'], ['Cougar Community Club', 'Olivia', 'Yates', 'Joe Trojan', "Mission Statement: Get involved in the Cannon community through actively participating in community service, supporting cougar athletes, and making our campus a better place.\nOverview:\nHosting bake sales and clothing drives to benefit local charities that surround Cannon School\nSupporting Cannon Faculty through bringing in treats for certain teaching departments each month\nPlanning certain times to clean up campus (trash) \nEncouraging students to attend sporting events/theater events that don't get as much attention\nParticipating in local charity events on weekends as a group "], ['Cougars Fighting Cancer', 'Destiny/Elliette ', 'Thomas/Zukowski', 'Dean Booker', 'We want to help spread awareness for cancer by doing fundraisers and other events to help raise money for the cause!'], ['Creative Writing Club', 'Cole Frei', 'Gabby Coppa', 'Mr. Smith', 'To help foster a creative spirit and appreciation for literature outside of an academic context by expression through writing. A place for people to practice writing skills and techniques without the pressure of grades or expectations.'], ['Cricket Club', 'Henry', 'Dryden', 'Tram', 'Tram '], ['Crypto Club', 'Ian/Zach ', 'Goff/Dollar', 'Kmidowski', 'The Crypto Club will focus on learning the ropes around crypto currency using guest speakers and interactive games. '], ['Debate Club', 'Annalise', 'Leck', 'Mr. Logan Arthur', "A club to debate and learn about other people's opinions and perspectives. "], ['Environmental Service Club (ESC)', 'Wylie', 'Neal', 'H. Smith', 'ESC aims to educate and provide environmentally related service events to the Cannon community.'], ['Envirothon', 'Rayyan', 'Syed', 'Mrs. Mattsson', "The Envirothon is a fun hands-on, natural science academic event that challenges and engages students to think critically about the natural world and their role in it, learning about NC's wildlife, aquatics, forestry, soils, and current environmental issues. It will be a fun filled year of learning about the world around us, enjoying club meetings, hearing from environmental experts, doing meaningful service projects, and competing at the Regional (and hopefully State) Envirothon competition!"], ['Eye to Eye ', 'Maddie', 'Rizzo', 'Mrs. Hurtado', 'To provide leadership opportunities to neurodiverse cannon highschool students, while allowing for them to feel more confident to express their needs through mentoring neurodiverse cannon middle school students.'], ['Film Club ', 'Lilly ', 'Carnaggio ', 'Mrs. Huffman ', 'Would just like to renew my club, last year we made a parody documentary, and analyzed several movie clips. This year my goal is to make more movies and learn the art of filmmaking with more hands on activities. '], ['Fishing Club', 'Ryan', 'Schreck', 'Mr. Diskin', 'The fishing club is a club where students can come to learn about fishing, be able to participate in fishing events at nearby ponds and lakes and be able to learn and enjoy fishing in a fun filled environment. Our goals are to introduce more people to fishing and teach others about it and show what makes us love it so much. '], ['Female Leaders In Stem Careers- FLISC', 'Abby Guilfoyle', 'Lilly Breese', 'Mrs. Ross', 'We will invite speakers who are women in male-dominated careers to talk about their profession and share their knowledge to inspire our peers. '], ['French Club ', 'Jessi Laws ', 'Kathryn Busby ', 'Ms. Flowers ', 'With this club we hope to spread aspects of french culture to students of French classes/ global education. Kathryn and I both have immersion experience in France and Quebec respectively. We are looking to make a group this year that we can practice speaking with and observing important French ceremonies and holidays.  '], ['Girls in STEM', 'Emma', 'Wang', 'Ms. Smith', "We'll be targeting late elementary to early middle school girls, teaching them about STEM and organizing fun STEM activities. The main objective of this club is to encourage more girls to pursue a career in STEM since there is still a gender imbalance in the field."], ['Habitat for Humanity Club', 'Lucy', 'Way', 'Sinden ', 'This club is partnered with Habitat for Humanity providing service opportunities for students who join. My goals are to connect with a restore for students to help organize, clean, and provide help for a day. Also I hope we can run the consession stand at the winter musical. Lastly, I hope to expand the club into new opportunities as Habitat for Humanity has a new coordinator who will be able to help us find these avenues. '], ['Habitat for Hummanity Club', 'Danny', 'Krug', 'Mr. Dunn', 'For this club, I want to help others and provide stable, affordable housing for people that don’t have access to good living conditions.'], ['Hiking Club', 'Mia', 'McHugh', 'Ms. Earnshaw', 'Our goal is to learn about hiking safety, as well as trail etiquette. We plan to do as many cool and fun hikes as possible that enrich students and get them outdoors. Hiking is extremely beneficial to students health, and my club encourages that. '], ['Hispanic/Latino Affinity Club ', 'Elias', 'Simon', 'Sra. Calles', "This club existed last year. Our goal is to provide a community for Hispanic and Latino students at Cannon, where we (and others!) can celebrate our culture and discuss matters that affect our community. This year, we are also trying to incorporate a service aspect —\xa0reaching out to local churches, charities, immigrant services, bilingual preschools, etc. to give back to members of our community that don't have the resources to go to Cannon. "], ['HOSA – Future Health Professionals', 'Rayyan', 'Syed', 'Mrs. Oswald', 'HOSA is a global student-led organization giving members the opportunity to pursue their interests in the health field by participating in competitive events, fundraisers, guest speaker  presentations, and volunteering services. You may also be able to win awards and scholarships at regional, state, and international levels. With a multitude of competitive events, there is something for everyone. From Biomedical Debate all the way to Veterinary Science, anybody can have a FUN time!'], ['I.M. F.I.N.E.', 'Hailey', 'Safranek', 'Mrs. Rice & Mrs. Allred-Magee ', 'A mental health club planning events to reduce stress and educate our peers on mental health.'], ['Investment Club', 'Sajan', 'Patel', 'Mr. Fleckman', 'Our club aims to educate fellow club members on all things investing. This includes learning about important trading strategies; seeing how to trade stocks, options, and crypto; and hearing from guest speakers. We will be doing paper-trading competition as well throughout the year, in order to allow for an interactive way to trade without using any real money. By the end of the year, club members will hopefully be able to use their skills form the clubs to increase their financials and work toward their goals w/ financial literacy.'], ['Juniorettes or Retts for short ', 'Willa ', 'Needham ', 'Mrs. Miller', 'It essentially is a service club. We would be sponsored by the Charlotte Women’s Club, however, the club would be open to anyone that is interested. There is an overlying service project that we could participate in for the school year, but we can also find what is important to us in order to center service projects around. The goals of the club are to serve the community around us and help contribute in any way we can. '], ['Key Club', 'Hosaena ', 'Fikadu', 'Ms.Kulp', "Our goal for this club is to give direct help and opportunities to those that want to help around in the community but don't know how. This is also an place where students can get help getting organized about their service hours and such. "], ['Leukemia and Lymphoma Student Visionaries (LLS)', 'James', 'Ter Poorten', 'Mr. Frye', "This club's objective will be to raise awareness of Leukemia and Lymphoma and other cancer and raise money through fundraisers and events to support the community. We will teach others in our community the effects it has on families and individuals and try to encourage people to join the mission to fight cancer. "], ['Life Skills Club', 'Grant Springate', 'Colby Dry', 'Joe Trojan', 'We will be teaching different life skills that are not taught in school and often not taught at home either. Things that we believe everyone should know, but many do not. For example, some of our ideas was a first aid/CPR session, financing, car mechanics, etc.'], ['Media Literacy Club', 'Shriya', 'Kovvali', 'Mrs. Fisher', 'Analysis of movies; tropes, themes & concepts explored in film, comparing of adaptations to original source material, discussion of representation in media, and overall, building media literacy among the members.'], ['Model UN', 'Ashmi', 'Trivedi', 'Mr. Kmidowski ', 'Model UN is a simulation of the UN General Assembly and its other bodies where students embody an ambassador role while debating global topics such as gender equality, climate action, global health, and more. We will be hosting the 10th annual CHARMUN conference at Cannon this year, so our goal is to support a collaborative and supportive community tasked with solving global issues.'], ['Neurodiversity and Disability Affinity and Advocacy Club', 'Maddie', 'Rizzo', 'Mrs. Miller', "This club will provide a space for neurodivergent students and students with disabilities to engage in meaningful conversation in order to feel supported and valued by their peers. This club's goals are to also create a sense of belonging for neurodiverse students at cannon and provide insight to some of the struggles that neurodiverse people face to our larger community."], ['Photography Club', 'Sajan', 'Patel', 'Tram Tran', 'Our club aims to educate our club members on different aspects of photography. We\'ll start out the year by covering the basics of cameras (settings, lighting, different modes, etc.). Then, for the middle/end of the year, we will go on "photo safaris" and take photos. Portrait, landscape, macro, etc.. We\'ll also go over editing on lightroom and photoshop, and by the end of the year, club members should have a great photo portfolio!'], ['Pickle Ball Club ', 'Jacob Herr', 'Isaac Szilagyi', 'Mr. Sinden ', 'We are creating this club to teach people the rules of growing sport of pickleball and provide a space to play.'], ['Project Purple', 'Catherine', 'Turner', 'Mrs. Holston', "A club to raise money and awareness for Alzheimer's. We plan events and raise money. "], ['R.I.S.E', 'Addison', 'Maynor', 'Brittany Pasut', 'R.I.S.E. (Resilience, Integrity, Service, and Empowerment) is a leadership/service group for upper school girls.   Our focus is to build communication, confidence, and leadership skills in females. We meet once a month, often with invited speakers from our community to share their expertise on leadership traits. We also have a goal to complete three group service projects representing Cannon School. (I created this club last year in 8th grade, and many of our members would like to continue our work into upper school.)'], ['Red Cross Club', 'Sajan', 'Patel', 'Mrs. Coughlin', 'The Red Cross Clubs aims to help serve the community in any way possible, whether through hands-on natural disaster relief & service, or through fundraising efforts for the American Red Cross. This is a service-oriented club, and will be be in accordance the North Carolina Region ARC. Our goal is for everyone participating in the club be able to be a contributing member in their community!'], ['Science Olympiad ', 'Nicole', 'Ratterman ', 'Mrs. Oswald ', 'This is a competitive science club that cannon has hosted for several years. The goal of the club is to foster students love for science and get some awards at the state competition!!'], ['Senior Club ', 'Brooke ', 'McGibbon ', 'Mrs. Weakland ', 'Me and Caroline DuMond are partnering with Taylor Glen senior community to engage more with senior citizens in our area. Our goals are to spend more time with the elderly folks, because we know from experience (our grandparents) how much they enjoy company from younger people. We are going to be visiting Taylor Glen once a month doing crafts like, bracelet making, painting, drawing, and much more with them. The reason we need this to be a club at Cannon because we need more participation with making birthday cards, holiday cards, and doing drives for senior shelters.  '], ['South Asian Affinity Group', 'Naya', 'Thakkar', 'Joe Tro ', 'Our group aims to provide a safe space to talk, interact and build a community within the south asian high school students at cannon. Having this club run for 2 years, we have had plenty experience running meetings and leading the group. Our objective is to share out culture with the rest of the high school while also creating a family and close knit group of a group of people who have the same ethnic background. '], ['Spanish Club', 'Annalise', 'Leck', 'Dr. Arriaga', "A club for students to improve their Spanish skills and learn more about Latin American cultures. We will continute our studies of Spanish from last year with the goal of improving everyone's language knowledge. "], ['Sports Writing Club', 'Danny', 'Saltzman', 'Mr. Smith', 'We want to write about sports and find other people passionate like us. We plan to submit one article a month to Cusp that we vote on. Our goal is to make people passionate about sports writing and to talk about sports with other people at Cannon. Nate Woolwine, Lucas Guilfoyle and I will run the club.'], ['Take a Break Club', 'Aashvi Shah', 'Sarah Doty', 'Mrs. Bumgarner', 'This club is meant for students to be able to take time out of their day to simply relax. Our goal is to provide a time for students who have busy schedules to focus on their mental health. We also plan to use this club as a way of spreading awareness about mental health and the importance of it. In the meetings we would do calming activities such as journaling, meditating, and more. Furthermore, this year we would like to start doing fundraisers to promote mental health awareness charities and possibly get guest speakers to talk about certain mental health related topics.'], ['Teacher Support Club', 'Angelina', 'Chen', 'Mrs. Ross', 'Teacher Support Club is similar to the established Peer Support Club but for the faculty and staff in Cannon. We gift teachers with supplies, thank you notes for all the hard work they do for us students, and treats like coffee and donuts to brighten up their mornings. We do this for every department in the upper school as a devotion to give back to our educators. '], ['The Cannon Upper School Paper (CUSP)', 'Ashmi', 'Trivedi', 'Ms. Earnshaw', 'The Cannon Upper School Paper represents the independent voice of the Upper School and amplifys student voices and opinions on pressing topics in our community.'], ['Veterans Volunteer Club', 'Vinayak', 'Duggal', 'Mr. Fleckman', 'Over the summer, I volunteered at the Veterans Health Administration Hospital and have close contact with the volunteer coordinator there. While volunteering, I noticed many veterans were struggling and were in need of many basic resources that we take for granted. I would like to start a club dedicated to supporting veterans by raising money and purchasing the resources veterans need. Money will be raised through various bake sales held outside the foundation hall. I plan on making "Thank you" cards for the veterans as well. If possible, I would like to collaborate with other clubs to further the work being done to support veterans. '], ['Women’s Empowerment', 'Sofia', 'Moncada', 'Mrs. Coughlin', 'Our club would focus on empowering women through Cannon and having fund raisers to donate food, clothes, and supplies to homeless women’s shelters. ']]

    for row in clubs_list[1:]: # skip the header row
            # extract the data from each row
            club_name = row[0]
            first_name = row[1]
            last_name = row[2]
            description = row[4]

            # reformat the data according to your rules
            if '/' in first_name:
                # Split first_name and last_name by "/"
                first_name_parts = first_name.split('/')
                last_name_parts = last_name.split('/')

                # Construct leaders string
                leaders = first_name_parts[0] + " " + last_name_parts[0] + ", " + first_name_parts[1] + " " + last_name_parts[1]

                email = first_name_parts[0][0] + last_name_parts[0] + "@cannonschool.org"

            else:
                leaders = first_name + " " + last_name # concatenate first and last name

                email = first_name[0] + last_name + "@cannonschool.org"
                email = email.lower()
                
            # create a new club instance and save it
            if " " in email:
                del email
                club = Club(name=club_name, leaders=leaders, description=description)
                club.save()
                continue
            club = Club(name=club_name, leaders=leaders, description=description, emails = email)
            club.save()
    template_name = "display/index.html"
    context_object_name = "club_list"
    def get_queryset(self):
        if not self.request.session.get("authenticated"):
            return []
        return Club.objects.order_by("name")


class DetailView(generic.DetailView):
    model = Club
    template_name = "display/detail.html"

    def get_queryset(self):
        if not self.request.session.get("authenticated"):
            return Club.objects.none()
        return Club.objects


class LoginView(View):
    template_name = 'display/login.html'  # Specify the path to your login template here
    success_url = 'display:index'  # Specify the success URL as an attribute

    def get(self, request):
        return render(request, self.template_name)

    def post(self, request):
        email = request.POST.get("email")
        security_question_answer = request.POST.get('security_answer')

        # Check if the email ends with cannonschool.org
        if email.endswith("@cannonschool.org"):
            # Check security question answer
            correct_answers = ["Humanitas", "Integritas", "Animus", "Impetus"]
            if security_question_answer in correct_answers:
                # Authentication successful
                request.session['authenticated'] = True
                next_url = request.GET.get('next')  # Get the 'next' parameter
                if next_url:
                    return redirect(next_url)  # Redirect to the intended page
                else:
                    return redirect(self.success_url)  # Redirect to the success URL
            else:
                messages.error(request, 'Incorrect security answer')
        else:
            messages.error(request, 'Invalid email domain')

        return render(request, self.template_name)